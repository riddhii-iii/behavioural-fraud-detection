<!DOCTYPE html>
<html>
<head>
    <title>Behavioural Login</title>
</head>
<body>
    <h2>Login</h2>

    <form id="loginForm">
        <input type="text" id="username" placeholder="Username"><br><br>
        <input type="password" id="password" placeholder="Password"><br><br>
        <button type="submit">Login</button>
    </form>

   <script>
    let keyTimings = [];
    let lastKeyTime = null;
    let mouseMovements = [];
    let clicks = 0;

    const passwordField = document.getElementById("password");

    passwordField.addEventListener("keydown", function() {
        let now = Date.now();

        if (lastKeyTime !== null) {
            keyTimings.push(now - lastKeyTime);
        }

        lastKeyTime = now;
    });

    document.addEventListener("mousemove", function(e) {
        mouseMovements.push({
            x: e.clientX,
            y: e.clientY,
            time: Date.now()
        });
    });

    document.addEventListener("click", function() {
        clicks += 1;
    });

    document.getElementById("loginForm").addEventListener("submit", function(e) {
        e.preventDefault();

        if (keyTimings.length === 0) {
            alert("Please type password properly.");
            return;
        }

        let avgTypingTime = keyTimings.reduce((a,b)=>a+b,0) / keyTimings.length;

        let payload = {
            avg_key_hold: avgTypingTime / 1000,
            typing_speed: 1 / (avgTypingTime / 1000),
            mouse_speed: mouseMovements.length,
            click_rate: clicks,
            session_duration: keyTimings.length
        };

        fetch("/predict", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify(payload)
        })
        .then(res => res.json())
        .then(data => {
            alert("Risk Score: " + data.risk_score + 
                  "\nResult: " + data.prediction);
        })
        .catch(error => {
            console.error("Error:", error);
            alert("Something went wrong. Check console.");
        });
    });
</script>
</body>
</html>