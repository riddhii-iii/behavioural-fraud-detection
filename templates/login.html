<!DOCTYPE html>
<html>
<head>
    <title>Behavioural Login</title>
</head>
<body>
    <h2>Login</h2>

    <form id="loginForm">
        <input type="text" id="username" placeholder="Username"><br><br>
        <input type="password" id="password" placeholder="Password"><br><br>
        <button type="submit">Login</button>
    </form>

    <script>
        let keyTimings = [];
        let lastKeyTime = null;
        let mouseMovements = [];
        let clicks = 0;

        // Capture keystrokes
        document.getElementById("password").addEventListener("keydown", function(e) {
            let now = Date.now();

            if (lastKeyTime !== null) {
                keyTimings.push(now - lastKeyTime);
            }

            lastKeyTime = now;
        });

        // Capture mouse movement
        document.addEventListener("mousemove", function(e) {
            mouseMovements.push({
                x: e.clientX,
                y: e.clientY,
                time: Date.now()
            });
        });

        // Capture clicks
        document.addEventListener("click", function() {
            clicks += 1;
        });

        document.getElementById("loginForm").addEventListener("submit", function(e) {
            e.preventDefault();

            let avgTypingSpeed = keyTimings.reduce((a,b)=>a+b,0)/keyTimings.length;
            let mouseSpeed = mouseMovements.length;
            let clickRate = clicks;

            fetch("/predict", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({
                    avg_key_hold: avgTypingSpeed/1000,
                    typing_speed: 1/(avgTypingSpeed/1000),
                    mouse_speed: mouseSpeed,
                    click_rate: clickRate,
                    session_duration: keyTimings.length
                })
            })
            .then(res => res.json())
            .then(data => alert(data.prediction));
        });
    </script>
</body>
</html>